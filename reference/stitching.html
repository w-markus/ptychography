
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stitching &#8212; Ptychography 4.0 0.1.0rc3 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Common" href="common.html" />
    <link rel="prev" title="Single Side Band" href="ssb.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-ptychography40.stitching.stitching">
<span id="stitching"></span><h1>Stitching<a class="headerlink" href="#module-ptychography40.stitching.stitching" title="Permalink to this headline">¶</a></h1>
<p>Created on Wed Sep  9 21:30:50 2020</p>
<p>&#64;author: oleh.melnyk</p>
<dl class="py function">
<dt id="ptychography40.stitching.stitching.stitch">
<code class="sig-prename descclassname"><span class="pre">ptychography40.stitching.stitching.</span></code><code class="sig-name descname"><span class="pre">stitch</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objects</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weighted'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-12</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ptychography40/stitching/stitching.html#stitch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ptychography40.stitching.stitching.stitch" title="Permalink to this definition">¶</a></dt>
<dd><p>In paralelized ptychography, each node returns recovered
part of the object up to a phase factor. Our goal is to stich those pieces by synchronizing
phase factors. To do so, we solve the angular synchronization, a
recovery of the unknown phase factors from their (noisy) pairwise differences
To obtain these pairwise differences, we compute the inner product between
two overlapping parts. Since on the overlap two objects are approximately the
same, it gives us the phase difference. Mathematically, it is given by
&lt; e^(i a_r1) O_r1, e^(i a_r2) O_r2 &gt; approx. = e^(i [a_r1 - a_r2]) norm(O_r1,r_2)^2,
where O_r is recovered r-th part of the object,
O_r1,r2 - part of the object corresponging to the overlap of two parts,
a_r - unknown phase factor.</p>
<p>This inner products are stored in the ph_diff matrix. Then, the matrix is entrywise
normalized to separate phases e^(i [a_r1 - a_r2]) and non-negative norm(O_r1,r_2)^2.</p>
<p>In angular synchronization we take phase differences as data and
can use norms as weights to solve (un)weighted least squares problem.
Problem itself is NP-hard and, thus, its relaxation instead is solved, which is
simply a computation of the eigenvector corresponding to the smallest eigenvalue
of the graph laplacian matrix.</p>
<p>Obtained eigenvector (v in code) is entrywise normalized to get phases.
Each part of the object is then phase-rotated correspondingly. Finally, we
join the pieces, avaraging on the overlaps.</p>
<p>Note: obtained solution is the original object up to a globabl phase factor.</p>
<p>For more details see Section 2 of <a class="reference external" href="https://arxiv.org/pdf/2005.02032.pdf">https://arxiv.org/pdf/2005.02032.pdf</a></p>
<p>Possible speed up of the routine: avoid dot product calculation of between all
parts, but only those which overlap.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>objects</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a>) – d1 X d2 X R array containing recovered pieces of object,
required to be stitched</p></li>
<li><p><strong>wtype</strong> (<a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>, </em><em>optional</em>) – Selected type of weights to be used in the angular synchronization
There are 2 possible choices:
‘unweighted’ or ‘weighted’, depending on usage or not of the weights for
angular synchronization (explained above)</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a><em>, </em><em>optional</em>) – Minimum absolute value to be considered in finding the phase match for stitching.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">Algorithms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ssb.html">Single Side Band</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Stitching</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html">Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasing.html">Releasing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Reference</a><ul>
      <li>Previous: <a href="ssb.html" title="previous chapter">Single Side Band</a></li>
      <li>Next: <a href="common.html" title="next chapter">Common</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2020, Ptychography 4.0 Authors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/reference/stitching.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>